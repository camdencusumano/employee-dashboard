<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Performance Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { margin-top: 40px; }
        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        canvas { max-width: 600px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Restaurant Performance Dashboard</h1>

    <!-- BOH-NUGGETS_Breader -->
    <h2>BOH-NUGGETS_Breader</h2>
    <table id="table-BOH-NUGGETS_Breader">
        <thead></thead>
        <tbody></tbody>
    </table>
    <canvas id="chart-BOH-NUGGETS_Breader"></canvas>

    <!-- BOH-NUGGETS_Assembler -->
    <h2>BOH-NUGGETS_Assembler</h2>
    <table id="table-BOH-NUGGETS_Assembler">
        <thead></thead>
        <tbody></tbody>
    </table>

    <!-- BOH-WAFFLE FRIES_Assembler -->
    <h2>BOH-WAFFLE FRIES_Assembler</h2>
    <table id="table-BOH-WAFFLE FRIES_Assembler">
        <thead></thead>
        <tbody></tbody>
    </table>
    <canvas id="chart-BOH-WAFFLE FRIES_Assembler"></canvas>

    <!-- BOH-GRILLED_Assembler -->
    <h2>BOH-GRILLED_Assembler</h2>
    <table id="table-BOH-GRILLED_Assembler">
        <thead></thead>
        <tbody></tbody>
    </table>

    <!-- BOH-GRILLED_Breader -->
    <h2>BOH-GRILLED_Breader</h2>
    <table id="table-BOH-GRILLED_Breader">
        <thead></thead>
        <tbody></tbody>
    </table>
    <canvas id="chart-BOH-GRILLED_Breader"></canvas>

    <!-- BOH-CFA_Buns -->
    <h2>BOH-CFA_Buns</h2>
    <table id="table-BOH-CFA_Buns">
        <thead></thead>
        <tbody></tbody>
    </table>

    <!-- BOH-GRILLED_Buns -->
    <h2>BOH-GRILLED_Buns</h2>
    <table id="table-BOH-GRILLED_Buns">
        <thead></thead>
        <tbody></tbody>
    </table>
    <canvas id="chart-BOH-GRILLED_Buns"></canvas>

    <!-- BOH-CFA_Assembler -->
    <h2>BOH-CFA_Assembler</h2>
    <table id="table-BOH-CFA_Assembler">
        <thead></thead>
        <tbody></tbody>
    </table>

    <!-- BOH-CFA_Breader -->
    <h2>BOH-CFA_Breader</h2>
    <table id="table-BOH-CFA_Breader">
        <thead></thead>
        <tbody></tbody>
    </table>

    <script>
        const SHEET_ID = '13qDCh1W91o_ZHGdXJo6vTlLZbosWQofk2JRk9CJvnaE';
        const API_KEY = 'AIzaSyD11ci9BCpFABOp09iNT6G_0sw6cmMKx3k';
        const TABS = [
            {
                name: 'BOH-NUGGETS_Breader',
                chart: true,
                headers: [
                    'Timestamp', 'Score', 'NAME OF BREADER (First Name, Last Initial)',
                    'MEDIUM: Nuggets meet color requirement',
                    'HIGH: Nuggets are entirely covered in a generous layer of seasoned coater, free of large lumps or uncooked coater',
                    'MEDIUM: Nuggets are free of bare spots', 'NAME OF INSPECTOR'
                ]
            },
            {
                name: 'BOH-NUGGETS_Assembler',
                chart: false,
                headers: [
                    'Timestamp', 'Score', 'NAME OF ASSEMBLER (First Name, Last Initial)',
                    'Internal temperature of cooked Nuggets (Diagnostic Only)',
                    'LOW: Nugget box has “N” tab pressed',
                    'LOW: Outside of menu tab box is free of excessive staining collectively larger than a nickel',
                    'Outside of packaging is free of residue, product, or excessive fingerprints, or smudges due to handling (Nuggets)',
                    'LOW: CFA Nugget box contains no more than one scrap',
                    'HIGH: Number of Chick-fil-A Nuggets present (no more or less than 8)',
                    'NAME OF INSPECTOR', 'MEDIUM: Nuggets are free of bare spots'
                ]
            },
            {
                name: 'BOH-WAFFLE FRIES_Assembler',
                chart: true,
                headers: [
                    'Timestamp', 'Score', 'NAME OF ASSEMBLER (First Name, Last Initial)',
                    'INFORMATIONAL: Internal Temperature of Waffle Potato Fries',
                    'HIGH: Waffle Potato Fry package appears full',
                    'INFORMATIONAL: Outside of packaging is free of residue, product, or excessive fingerprints, or smudges',
                    'HIGH: Waffle Potato Fries are evenly cooked (crisp on outside and soft inside) not scorched or soggy',
                    'MEDIUM: Waffle Potato Fries meet color requirements',
                    'MEDIUM: There are not an excessive number of small pieces',
                    'NAME OF INSPECTOR'
                ]
            },
            {
                name: 'BOH-GRILLED_Assembler',
                chart: false,
                headers: [
                    'Timestamp', 'Score', 'NAME OF ASSEMBLER (First Name, Last Initial)',
                    'Internal Temperature of Grilled Filet (Diagnostic Only)',
                    'LOW: Clamshell is securely closed with both locking tabs secured, product not protruding from clamshell',
                    'LOW: Outside of clamshell is free of excessive staining larger than a quarter',
                    'LOW: Outside of clamshell is free of residue, product, or excessive fingerprints, or smudges due to handling larger than a quarter',
                    'LOW: Grilled Chicken Sandwich is served in a sandwich sleeve inside clamshell',
                    'LOW: Best grill marks on grilled filet are facing up',
                    'MEDIUM: Multigrain brioche bun is not torn or crushed, with no flaking or peeling',
                    'MEDIUM: There are 2 whole slices (3 if small) of tomato. (3/16" thick)',
                    'LOW: Tomato slices have no visible core, no hole in center, no end slices',
                    'MEDIUM: There are 2 Green Leaf lettuce leaves on grilled sandwich',
                    'LOW: Lettuce leaf diameter is approximately 4" (+/-0.5")',
                    'NAME OF INSPECTOR', 'HIGH: Grilled filet has acceptable bun coverage',
                    'LOW: Multigrain brioche bun is toasted to the correct color',
                    'HIGH: Grilled filet is free of excessive carbon build up (both sides)'
                ]
            },
            {
                name: 'BOH-GRILLED_Breader',
                chart: true,
                headers: [
                    'Timestamp', 'Score', 'NAME OF BREADER (First Name, Last Initial)',
                    'LOW: Grilled chicken is correct color (best grill marks side)',
                    'HIGH: Grilled filet is free of excessive carbon build up (both sides)',
                    'HIGH: Grilled filet has acceptable bun coverage',
                    'Weight of cooked grilled filet (Diagnostic)', 'NAME OF INSPECTOR'
                ]
            },
            {
                name: 'BOH-CFA_Buns',
                chart: false,
                headers: [
                    'Timestamp', 'Score', 'NAME OF BUNS (First Name, Last Initial)',
                    'MEDIUM: There are 2 well drained pickle chips (3 if small) on sandwich',
                    'LOW: Pickles overlap by no more than a quarter of pickle area',
                    'LOW: Pickles are not hanging off bun heel',
                    'LOW: White hamburger-style bun crown (top) is buttered with butter-flavored oil',
                    'LOW: White hamburger-style bun crown is toasted evenly to correct color',
                    'LOW: White hamburger-style bun heel is toasted evenly to correct color',
                    'NAME OF INSPECTOR',
                    'LOW: White hamburger-style bun heel (bottom) is buttered with butter-flavored oil',
                    'MEDIUM: White bun is not torn or crushed, with no flaking or peeling (don’t mark no if flaking clearly caused by assembler)'
                ]
            },
            {
                name: 'BOH-GRILLED_Buns',
                chart: true,
                headers: [
                    'Timestamp', 'Score', 'NAME OF BUNS (First Name, Last Initial)',
                    'MEDIUM: Multigrain brioche bun is not torn or crushed, with no flaking or peeling',
                    'LOW: Multigrain brioche bun crown (top) is toasted evenly to correct color',
                    'LOW: Multigrain brioche bun heel (bottom) is toasted evenly to correct color',
                    'NAME OF INSPECTOR'
                ]
            },
            {
                name: 'BOH-CFA_Assembler',
                chart: false,
                headers: [
                    'Timestamp', 'Score', 'NAME OF ASSEMBLER (First Name, Last Initial)',
                    'LOW: Outside of packaging is free of excessive staining collectively larger than a quarter (Chick-fil-A Sandwich)',
                    'LOW: Outside of packaging is free of residue, product, or excessive fingerprints, or smudges due to handling.',
                    'LOW: Top of foil bag is pressed in and folded down twice (each fold 1/2” in width) to cover and secure opening of bag',
                    'MEDIUM: White hamburger-style bun is not torn or crushed, with no flaking or peeling',
                    'HIGH: Chick-fil-A regular filet has acceptable bun coverage',
                    'MEDIUM: Chick-fil-A regular filet is golden brown in appearance',
                    'HIGH: Side facing up: Chick-fil-A filet is entirely covered in a generous layer of seasoned coater, free of large lumps or uncooked coater',
                    'MEDIUM: Total area of bare spots on Chick-fil-A regular filet is no larger than a quarter',
                    'NAME OF INSPECTOR',
                    'HIGH: Chick-fil-A regular filet has acceptable bun coverage'
                ]
            },
            {
                name: 'BOH-CFA_Breader',
                chart: false,
                headers: [
                    'Timestamp', 'Score', 'NAME OF BREADER (First Name, Last Initial)',
                    'HIGH: Side facing up: Chick-fil-A filet is entered covered in a generous layer of seasoned coater, free of large lumps or uncooked coater',
                    'INFORMATIONAL: Weight of cooked Chick-fil-A regular filet is at least 3.3 oz',
                    'MEDIUM: Total area of bare spots on Chick-fil-A regular filet is no larger than a quarter (side facing up only)',
                    'MEDIUM: Chick-fil-A regular filet is golden brown in appearance',
                    'HIGH: Chick-fil-A filet has acceptable bun coverage',
                    'NAME OF INSPECTOR'
                ]
            }
        ];

        async function fetchTabData(tab) {
            const API_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(tab.name)}?key=${API_KEY}`;
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`Failed to fetch data for ${tab.name}`);
                const data = await response.json();
                const rows = data.values;

                // Assuming first row is headers
                const headers = rows[0];
                const dataRows = rows.slice(1);

                // Map headers to indices
                const colMap = {};
                tab.headers.forEach(header => {
                    colMap[header] = headers.indexOf(header);
                });

                // Populate table
                const table = document.querySelector(`#table-${tab.name}`);
                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');

                // Create table headers
                const headerRow = document.createElement('tr');
                tab.headers.forEach(header => {
                    const th = document.createElement('th');
                    th.textContent = header;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                // Populate table rows
                dataRows.forEach(row => {
                    const tr = document.createElement('tr');
                    tab.headers.forEach(header => {
                        const td = document.createElement('td');
                        const colIndex = colMap[header];
                        td.textContent = colIndex !== -1 && row[colIndex] ? row[colIndex] : '';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                // Create chart if required
                if (tab.chart) {
                    const scoreCounts = {};
                    dataRows.forEach(row => {
                        const score = row[colMap['Score']] || 'Unknown';
                        scoreCounts[score] = (scoreCounts[score] || 0) + 1;
                    });

                    const ctx = document.getElementById(`chart-${tab.name}`).getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(scoreCounts),
                            datasets: [{
                                label: 'Score Distribution',
                                data: Object.values(scoreCounts),
                                backgroundColor: ['#4caf50', '#ff9800', '#f44336', '#2196f3'],
                            }]
                        },
                        options: {
                            scales: {
                                y: { beginAtZero: true, ticks: { precision: 0 } }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error(`Error fetching ${tab.name}:`, error);
                alert(`Failed to load data for ${tab.name}. Check console for details.`);
            }
        }

        // Fetch data for all tabs
        Promise.all(TABS.map(tab => fetchTabData(tab)))
            .then(() => console.log('All tabs loaded'))
            .catch(error => console.error('Error loading tabs:', error));
    </script>
</body>
</html>
